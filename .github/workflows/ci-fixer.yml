name: CI Fixer

# Automatic CI failure resolution integrated with jbcom/control-center
# When CI fails, this workflow coordinates with Claude to:
# - Analyze the failure logs
# - Identify the root cause
# - Apply fixes automatically
# - Commit and push fixes to the PR branch

on:
  workflow_run:
    workflows: ["CI"]
    types: [completed]

permissions:
  contents: write
  pull-requests: write
  checks: read

jobs:
  # Auto-fix CI failures using control-center ecosystem
  fix-ci:
    name: Auto-fix CI Failure
    if: |
      github.event.workflow_run.conclusion == 'failure'
    uses: jbcom/control-center/.github/workflows/ecosystem-fixer.yml@main
    with:
      run_id: ${{ github.event.workflow_run.id }}
      repository: ${{ github.repository }}
      branch: ${{ github.event.workflow_run.head_branch }}
    secrets:
      CI_GITHUB_TOKEN: ${{ secrets.CI_GITHUB_TOKEN }}
      GOOGLE_JULES_API_KEY: ${{ secrets.GOOGLE_JULES_API_KEY }}
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
