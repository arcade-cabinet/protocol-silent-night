# Spec: 1.0 Anime Combat Effects

## Overview
Implement DBZ/Kill La Kill style combat effects that create dramatic visual explosions during clashes, obscuring the lack of precise collision detection.

## Requirements

### R1: Clash Detection
- MUST trigger on proximity (distance < threshold)
- MUST NOT require precise collision
- MUST support cooldown to prevent spam
- SHOULD support multiple simultaneous clashes

### R2: Visual Explosion
- MUST spawn massive GPU particle system
- MUST cover both combatants completely
- MUST include energy/fire/spark particles
- SHOULD include speed lines/motion blur

### R3: Camera Effects
- MUST shake camera on impact
- MUST pull camera back during clash
- SHOULD add screen flash effect
- SHOULD support slow-motion (time dilation)

### R4: Knockback
- MUST animate combatants flying apart
- MUST play "power clash" pose during
- SHOULD include anime-style pose hold

## Design

### Clash Sequence
```
1. Proximity detected (dist < 2.5)
2. Halt enemy AI movement
3. Both play "powerup" animation
4. Spawn explosion at midpoint
5. Camera shake + pullback
6. Screen flash
7. Knockback tween (fly apart)
8. Apply damage
9. Resume normal gameplay
```

### Particle System
```tsx
function spawnExplosion(position: Vector3) {
  return (
    <GPUParticleSystem
      emitter={position}
      capacity={20000}
      emitRate={15000}
      minSize={0.1}
      maxSize={3.0}
      minLifeTime={0.3}
      maxLifeTime={1.5}
      color1="#ffaa00"  // Orange
      color2="#ff4400"  // Red
      blendMode="add"
      gravity={[0, -9.8, 0]}
    />
  );
}
```

### Camera Shake
```tsx
function cameraShake(intensity: number, duration: number) {
  // Random offset each frame
  const offset = new Vector3(
    (Math.random() - 0.5) * intensity,
    (Math.random() - 0.5) * intensity,
    0
  );

  // Apply and decay
  camera.position.addInPlace(offset.scale(0.1));

  // Pullback
  camera.radius *= 1.2;

  // Reset after duration
  setTimeout(() => {
    camera.radius /= 1.2;
  }, duration);
}
```

### Knockback Animation
```tsx
function knockback(mesh: AbstractMesh, direction: Vector3, force: number) {
  Animation.CreateAndStartAnimation(
    'knockback',
    mesh,
    'position',
    60,  // FPS
    30,  // Frames
    mesh.position,
    mesh.position.add(direction.scale(force)),
    Animation.ANIMATIONLOOPMODE_CONSTANT
  );
}
```

## Tasks

### Tier 1: Clash Trigger
- [ ] T1.1: Implement proximity detection system
- [ ] T1.2: Add clash cooldown tracking
- [ ] T1.3: Create ClashEffect container component
- [ ] T1.4: Wire to game loop

### Tier 2: Particles
- [ ] T2.1: Create ExplosionParticles component
- [ ] T2.2: Configure particle textures (flare, spark)
- [ ] T2.3: Tune timing and colors
- [ ] T2.4: Test performance (20k particles)

### Tier 3: Camera Effects
- [ ] T3.1: Implement camera shake hook
- [ ] T3.2: Add camera pullback
- [ ] T3.3: Implement screen flash (GlowLayer)
- [ ] T3.4: Optional: time dilation

### Tier 4: Knockback
- [ ] T4.1: Create knockback animation function
- [ ] T4.2: Implement "power pose" hold
- [ ] T4.3: Wire damage calculation
- [ ] T4.4: Handle enemy defeat during clash

## Acceptance Criteria
- [ ] Combat feels impactful, not floaty
- [ ] Can't see actual collision point (obscured)
- [ ] Camera creates sense of weight
- [ ] Effects don't drop below 30fps
- [ ] Multiple clashes can occur simultaneously
- [ ] Kill La Kill / DBZ aesthetic achieved
