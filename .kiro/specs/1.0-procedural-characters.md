# Spec: 1.0 Procedural Character System

## Overview
Replace deprecated @jbcom/strata with BabylonJS procedural character generation using lofted splines, dynamic textures, and rigged bones.

## Requirements

### R1: Character Structure
- MUST generate humanoid mesh procedurally
- MUST support male/female morphing
- MUST support configurable muscle/height
- MUST NOT use primitive stacking (no blocky look)

### R2: Visual Quality
- MUST use subdivision for smooth meshes
- MUST use lofted splines for tapered limbs
- MUST generate anime-style face with DynamicTexture
- SHOULD support hair variations (spiky, flowing)

### R3: Animation Support
- MUST support rigged skeleton
- MUST support controllable limb bones
- MUST animate walk/run cycles
- MUST animate attack animations

### R4: DDL Integration
- MUST read config from classes.json
- MUST support skin color variations
- MUST support equipment slots
- SHOULD support material swapping

## Design

### AnimeHero Component
```tsx
interface AnimeHeroProps {
  config: ClassConfig;    // From classes.json
  position: Vector3;
  isMoving: boolean;
  isFiring: boolean;
}

<AnimeHero
  config={classes.santa}
  position={playerPosition}
  isMoving={true}
  isFiring={false}
/>
```

### Body Generation (Lofted, Not Primitives)
```tsx
// Torso: Bezier path extruded with taper
<ExtrudeShape
  shape={torsoProfile}  // Curved, not rectangular
  path={[{y: 0}, {y: 1.2}]}
  subdivision={4}       // Smooth result
/>

// Limbs: Curved tubes, not cylinders
<Tube
  path={armBezierPath}  // Natural arm curve
  radius={muscle * 0.1}
  tessellation={16}
/>
```

### Anime Face (DynamicTexture)
```tsx
function drawAnimeFace(ctx: CanvasRenderingContext2D) {
  // Big glossy eyes (Ghost in the Shell style)
  ctx.fillStyle = '#FFF';
  ctx.arc(150, 200, 60, 0, Math.PI * 2);
  ctx.arc(362, 200, 60, 0, Math.PI * 2);
  ctx.fill();

  // Sharp pupils
  ctx.fillStyle = '#000';
  ctx.arc(150, 200, 25, 0, Math.PI * 2);
  ctx.arc(362, 200, 25, 0, Math.PI * 2);
  ctx.fill();

  // Expression lines
  // ...
}
```

### Skeleton System
```tsx
<Skeleton name="heroSkel">
  <Bone name="root" position={[0, 0, 0]}>
    <Bone name="spine" position={[0, 0.5, 0]}>
      <Bone name="chest" position={[0, 0.8, 0]}>
        <Bone name="leftShoulder" position={[-0.3, 0, 0]}>
          <Bone name="leftUpperArm" />
        </Bone>
        <Bone name="rightShoulder" position={[0.3, 0, 0]}>
          <Bone name="rightUpperArm" />
        </Bone>
      </Bone>
    </Bone>
  </Bone>
</Skeleton>
```

## Tasks

### Tier 1: Base Mesh
- [ ] T1.1: Create ProceduralTorso component
- [ ] T1.2: Create ProceduralLimbs components
- [ ] T1.3: Apply subdivision smoothing
- [ ] T1.4: Test with default config

### Tier 2: Visual Polish
- [ ] T2.1: Implement DynamicTexture face
- [ ] T2.2: Create spiky hair ribbons
- [ ] T2.3: Add cel-shading material
- [ ] T2.4: Implement gender morphing

### Tier 3: Animation
- [ ] T3.1: Create skeleton hierarchy
- [ ] T3.2: Bind mesh vertices to bones
- [ ] T3.3: Implement walk cycle
- [ ] T3.4: Implement attack animation
- [ ] T3.5: Wire to isMoving/isFiring props

## Acceptance Criteria
- [ ] Character renders without @jbcom/strata
- [ ] Character looks smooth, not blocky
- [ ] Face has anime-style eyes
- [ ] Walk animation plays when moving
- [ ] Attack animation plays when firing
- [ ] All three classes (Santa, Elf, Bumble) render correctly
- [ ] Config changes from DDL reflect in visual
